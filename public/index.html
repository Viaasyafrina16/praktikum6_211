<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Generator & Daftar API Key</title>

  <style>
    :root{
      --bg:#f3edf9;
      --card:#fef7ff;
      --accent:#7c3aed;
      --muted:#6b7280;
      --border:#e5e7eb;
    }

    body{
      margin:0;
      padding:20px;
      background:var(--bg);
      font-family:Inter, sans-serif;
      color:#374151;
    }

    h1{
      text-align:center;
      margin-bottom:20px;
      color:#4b3c8f;
    }

    .box{
      background:var(--card);
      width:100%;
      max-width:600px;
      margin:0 auto 20px auto;
      padding:20px;
      border-radius:12px;
      box-shadow:0 4px 16px rgba(0,0,0,0.05);
      border:1px solid var(--border);
    }

    input{
      width:100%;
      padding:10px;
      margin:10px 0;
      border-radius:8px;
      border:1px solid var(--border);
    }

    button{
      background:var(--accent);
      padding:10px 16px;
      color:white;
      border:none;
      border-radius:10px;
      font-weight:600;
      cursor:pointer;
      width:100%;
    }

    table{
      width:100%;
      border-collapse:collapse;
      margin-top:10px;
    }

    th, td{
      padding:12px;
      border-bottom:1px solid var(--border);
      font-size:14px;
    }

    th{
      background:#ede7fb;
      color:#4b3c8f;
      font-weight:600;
      text-align:left;
    }

    .no-data{
      text-align:center;
      padding:20px;
      color:var(--muted);
    }

    tr:hover{
      background:#f8f4ff;
    }
  </style>
</head>
<body>

<h1>Generator API Key</h1>

<div class="box">
  <label>Nama Aplikasi</label>
  <input type="text" id="appName" placeholder="Masukkan nama aplikasi...">

  <button onclick="generateKey()">Generate API Key</button>

  <p id="status"></p>
</div>

<div class="box">
  <h3>Daftar API Key</h3>

  <table>
    <thead>
      <tr>
        <th>Nama</th>
        <th>API Key</th>
        <th>Dibuat</th>
      </tr>
    </thead>

    <tbody id="dataBody">
      <tr><td colspan="3" class="no-data">Memuat data...</td></tr>
    </tbody>
  </table>
</div>

<script>
async function generateKey(){
  const name = document.getElementById("appName").value;
  const status = document.getElementById("status");

  if(!name){
    status.innerHTML = "⚠ Nama aplikasi wajib diisi!";
    status.style.color = "red";
    return;
  }

  status.innerHTML = "⏳ Mengirim...";

  try{
    const res = await fetch("/create", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ name })
    });

    const data = await res.json();

    if(data.success){
      status.style.color = "green";
      status.innerHTML = `✅ API Key dibuat: <b>${data.data.apiKey}</b>`;
      document.getElementById("appName").value = "";
      loadAPIKeys();  // refresh tabel
    } else {
      status.style.color = "red";
      status.innerHTML = "Gagal membuat API Key!";
    }

  } catch (e){
    status.style.color = "red";
    status.innerHTML = "Error saat mengirim!";
  }
}

async function loadAPIKeys(){
  const tbody = document.getElementById("dataBody");

  try{
    const res = await fetch("/api/keys");
    const json = await res.json();

    const data = json.data;

    if(!data || data.length === 0){
      tbody.innerHTML = `<tr><td colspan="3" class="no-data">Belum ada API Key</td></tr>`;
      return;
    }

    tbody.innerHTML = "";

    data.forEach(row => {
      tbody.innerHTML += `
        <tr>
          <td>${row.name}</td>
          <td>${row.api_key}</td>
          <td>${new Date(row.created_at).toLocaleString()}</td>
        </tr>
      `;
    });

  } catch (err){
    tbody.innerHTML = `<tr><td colspan="3" class="no-data">Gagal memuat data</td></tr>`;
  }
}

loadAPIKeys();
</script>

</body>
</html>
